<!-- 
DESCRIPTION ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>exp</title>
  <script src="jsPsych-6.1.0/jspsych.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-html-slider-response.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-survey-text.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-survey-multi-choice.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-external-html.js"></script>
  <script src="js/jspsych-html-slider-response_required.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/lodash.min.js"></script>
  <script src="js/firebase.js"></script>
  <link href="jsPsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css">
  <style>
  body {
    cursor: default;
  }
  #jspsych-html-slider-response-next {
    margin: 0px;
  }
  .imgJudge {
    width: 300px;
    margin: 0px;
    padding: 0px;
  }
  .jspsych-content-wrapper {
    width: 900px;
    height: 1500px;
  }
</style>
</head>
<body></body>
<script>
  /* Parameters */
  var n = 10; // number of CIs randomly sample for each cell (should be 20)
  var githubCIs = 'cis/'; // github CIs path

  /* Initial variables */
  var timeline = [];
  var preloadimages = [];
  var prolificID = jsPsych.data.getURLVariable("PROLIFIC_PID"); // Need to add ?prolificID={{%PROLIFIC_PID%}} at the end of the prolific survey link!

  /* Functions */
  function flatten(arr) {
    return arr.reduce(function (flat, toFlatten) {
      return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);
    }, []);
  };

  // Condition-level CIs
var cis_condition = [
"cis/ci_avg_neg.png",
"cis/ci_avg_pos.png"]

  // Subgroup-level CIs
var cis_number = [
"1",
"2",
"3",
"4",
"5",
"6",
"7",
"8",
"9",
"10",
"11",
"12",
"13",
"14",
"15",
"16",
"17",
"18",
"19",
"20",
"21",
"22",
"23",
"24",
"25",
"26",
"27",
"28",
"29",
"30",
"31",
"32",
"33",
"34",
"35",
"36",
"37",
"38",
"39",
"40",
"41",
"42",
"43",
"44",
"45",
"46",
"47",
"48",
"49",
"50",
"51",
"52",
"53",
"54",
"55",
"56",
"57",
"58",
"59",
"60",
"61",
"62",
"63",
"64",
"65",
"66",
"67",
"68",
"69",
"70",
"71",
"72",
"73",
"74",
"75",
"76",
"77",
"78",
"79",
"80",
"81",
"82",
"83",
"84",
"85",
"86",
"87",
"88",
"89",
"90",
"91",
"92",
"93",
"94",
"95",
"96",
"97",
"98",
"99",
"100",
"101",
"102",
"103",
"104",
"105",
"106",
"107",
"108",
"109",
"110",
"111",
"112",
"113",
"114",
"115",
"116",
"117",
"118",
"119",
"120",
"121",
"122",
"123",
"124",
"125",
"126",
"127",
"128", 
"129",
"130",
"131",
"132",
"133",
"134",
"135",
"136",
"137",
"138",
"139",
"140",
"141",
"142",
"143",
"144",
"145",
"146",
"147",
"148",
"149",
"150",
"151",
"152",
"153",
"154",
"155",
"156",
"157",
"158",
"159",
"160",
"161",
"162",
"163",
"164",
"165",
"166",
"167",
"168",
"169",
"170",
"171",
"172",
"173",
"174",
"175",
"176",
"177",
"178"
];

  // Randomly pick n subgroup IDs
  cis_number = _.sampleSize(cis_number, n);

  // pos / neg for each subgroup ID 
  cis_pos = cis_number.map(function(e) {return githubCIs + "ci_" + e + "_sbgp_pos.png"});
  cis_neg = cis_number.map(function(e) {return githubCIs + "ci_" + e + "_sbgp_neg.png"});
  
  // flatten deep
  var CIsStims_subgroup = _.flattenDeep([cis_pos, cis_neg]);
  
  // preload images
  preloadimages.push(cis_condition);
  preloadimages.push(CIsStims_subgroup);

  // CIs stims for condition- and subgroup-level CIs
  CIsStims_condition = cis_condition.map(function(e) {return {imgHtml: "<img class='imgJudge' src='" + e + "'>"}});
  CIsStims_subgroup = CIsStims_subgroup.map(function(e) {return {imgHtml: "<img class='imgJudge' src='" + e + "'>"}});

  CIsStims_condition = _.shuffle(CIsStims_condition); // randomize order
  CIsStims_subgroup = _.shuffle(CIsStims_subgroup); // randomize order


/*
  // Preload images
  preloadimages.push(imgLink_avg, imgLink_subgroup, preview_subgroup);
  preloadimages = flatten(preloadimages);
*/
  // EXPERIMENT --------------------------------------------------------------------------------------------------------

  /* FULL SCREEN MODE */
  var activeFullscreen = {
    message: "",
    button_label: "To start the study, please switch to fullscreen",
    type: 'fullscreen',
    fullscreen_mode: true,
    delay_after: 200,
  };

  // Consent
    var check_consent = function(elem) {
      if (document.getElementById('info').checked 
        & document.getElementById('volunt').checked 
        & document.getElementById('anony').checked 
        & document.getElementById('end').checked 
        & document.getElementById('consqc').checked 
        & document.getElementById('summ').checked 
        & document.getElementById('participate').checked ) {
        return true;
      }
      else {
        alert("If you wish to participate, you must check all the boxes.");
        return false;
      }
      return false;
    };


    var consent = {
      type:'external-html',
      url: "https://marinerougier.github.io/Ugent_1/external_page_consent.html",
      cont_btn: "start",
      check_fn: check_consent
    };

  var Quit_expe = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function() {
      var html = "";
      html += "<h1>Before starting...</h1>";
      html += "<p class='justify'>You can quit the study at any time by closing the browser window. However, please be aware ";
      html += "that this will <b>end your participation</b>. If you are certain that you want to quit or encounter technical issues ";
      html += "that force you to quit, <b>you can still receive a partial reward proportionate to the time you actually spent</b> on ";
      html += "the study. If this occurs, please take the following steps: Return the study via the Prolific study page as ";
      html += "quickly as possible (please do not submit unless you have completed the study and received a completion code). ";
      html += "Send a message to the researcher via the Prolific study page, stating that you completed part of the study ";
      html += "(this will ensure that the researcher knows you should receive a partial reward). </br></br> ";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

   var instr_gene = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function() {
      var html = "";
      html += "<h1>Faces rating</h1>";
      html += "<p class='justify'>In this study, you task is to <b>evaluate several faces</b> (12 faces in total). More specifically, your task "
      html += "will be to evaluate each face on a series of <b>54 personality traits and personality outcomes. </b></br> ";
      html += "As you will see, these faces have been <b>blurred</b> to make the task more challenging. </br></br>";
      html += "This study consists in two parts. In Part 1, you will evaluate 2 faces and in Part 2 you will evaluate 10 faces. </br></br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to begin</p>";
      return html;
    },
  };

  /* PREVIEW CIS INSTRUCTIONS */
  var previewCIinst_avg = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function() {
      var html = "";
      html += "<h1>Faces rating: Part 1</h1>";
      html += "<p class='justify'>Before the evaluation task, <b>we will first briefly present you the 2 faces that you will evaluate</b> ";
      html += "for you to better gauge the similarities and differences between them. <br><br> ";
      html += "Faces will be <b>automatically paced</b> during 1 second each. Pleace remain focused.</br></br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to begin</p>";
      return html;
    },
  };

  var previewCIinst_subgroup = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function() {
      var html = "";
      html += "<h1>Faces rating: Part 2</h1>";
      html += "<p class='justify'>Part 1 is over. In this part, you will <b>judge 10 faces</b>. </br> ";
      html += "Before the evaluation task, <b>we will first briefly present you these faces</b> ";
      html += "for you to better gauge the similarities and differences between them. <br><br> ";
      html += "Faces will be automatically paced during 1 second each. Pleace remain focused.</br></br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to begin</p>";
      return html;
    },
      on_load: function() {
          $(".jspsych-content").css("max-width", "90%");
       }
  };

 /* JUDGMENTS INSTRUCTIONS */
  var jugmentInst_avg = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function() {
      var html = "";
      html += "<h1>Faces rating: Part 1</h1>";
      html += "<p class='justify'>Now, you will rate the 2 faces.</b>";
      html += " Again, try to answer <b> as honestly and as spontaneously as possible. </b></br></br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to begin</p>";
      return html;
    },
  };

  var jugmentInst_subgroup = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function() {
      var html = "";
      html += "<h1>Faces rating: Part 2</h1>";
      html += "<p class='justify'>Now, you will rate the 10 faces.</b>";
      html += " Again, try to answer <b> as honestly and as spontaneously as possible. </b></br></br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to begin</p>";
      return html;
    },
  };


/* PREVIEW CIS */
  var previewCI_avg = {
    timeline_variables: CIsStims_condition,
    choices: jsPsych.NO_KEYS,
    trial_duration: 1000,
    post_trial_gap: 100,
    timeline: [{
      type: 'html-keyboard-response',
      stimulus: function() {return jsPsych.timelineVariable('imgHtml', true)},
    }]
  };

  var previewCI_subgroup = {
    timeline_variables: CIsStims_subgroup,
    choices: jsPsych.NO_KEYS,
    trial_duration: 1000,
    post_trial_gap: 100,
    timeline: [{
      type: 'html-keyboard-response',
      stimulus: function() {return jsPsych.timelineVariable('imgHtml', true)},
    }]
  };

/* JUDGMENT CIS */

  //social competence:
  var scaleSociable = ["0</br>Not sociable at all", "1", "2", "3", "4", "5</br>Totally sociable"];
  var scaleFunLoving = ["0</br>Not fun loving at all", "1","2", "3", "4", "5</br>Totally fun loving"];
  var scaleLikable = ["0</br>Not likable at all", "1", "2", "3", "4", "5</br>Totally likable"];
  var scalePopular = ["0</br>Not popular at all", "1", "2", "3", "4", "5</br>Totally popular"];
  var scaleFriendly = ["0</br>Not friendly at all", "1", "2", "3", "4", "5</br>Totally friendly"];   //new
  var scaleFunny = ["0</br>Not funny at all", "1", "2", "3", "4", "5</br>Totally funny"];            //new
  var scaleAgreeable = ["0</br>Not agreeable at all", "1", "2", "3", "4", "5</br>Totally agreeable"];//new
  var scaleWarm = ["0</br>Not warm at all", "1", "2", "3", "4", "5</br>Totally warm"];               //new

  // intellectual competence:
  var scaleIntelligent = ["0</br>Not intelligent at all", "1", "2", "3", "4", "5</br>Totally intelligent"];
  var scaleSkillful = ["0</br>Not skillful at all", "1", "2", "3", "4", "5</br>Totally skillful"];
  var scaleRational = ["0</br>Not rational at all", "1", "2", "3", "4", "5</br>Totally rational"];
  var scaleScientific = ["0</br>Not scientific at all", "1", "2", "3", "4", "5</br>Totally scientific"];
  var scaleAmbitious = ["0</br>Not ambitious at all", "1", "2", "3", "4", "5</br>Totally ambitious"];
  var scaleHardWorking = ["0</br>Not hard-working at all", "1", "2", "3", "4", "5</br>Totally hard-working"];
  var scaleSuccess = ["0</br>Unlikely to achieve career success", "1", "2", "3", "4", "5</br>Likely to achieve career success"];

  // concerns for others
  var scaleSensitive = ["0</br>Not sensitive at all", "1", "2", "3", "4", "5</br>Totally sensitive"];
  var scaleEmpathic = ["0</br>Not empathic at all", "1", "2", "3", "4", "5</br>Totally empathic"];
  var scaleCompassionate = ["0</br>Not compassionate at all", "1", "2", "3", "4","5</br>Totally compassionate"];
  var scaleGenerous = ["0</br>Not generous at all", "1", "2", "3", "4", "5</br>Totally generous"];
  var scaleModest = ["0</br>Not modest at all", "1", "2", "3", "4", "5</br>Totally modest"];
  var scaleEgoistic = ["0</br>Not egoistic at all", "1", "2", "3", "4", "5</br>Totally egoistic"];

  // Integrity
  var scaleTrustworthy = ["0</br>Not trustworthy at all", "1", "2", "3", "4", "5</br>Totally trustworthy"];
  var scaleHonest = ["0</br>Not honest at all", "1", "2", "3", "4", "5</br>Totally honest"];
  var scaleFaithful  = ["0</br>Unlikely to be faithful to the spouse", "1", "2", "3", "4", "5</br>Likely to be faithful to the spouse"];
  var scaleSneaky = ["0</br>Not sneaky at all", "1", "2", "3", "4", "5</br>Totally sneaky"];    //new
  var scaleMoral = ["0</br>Not moral at all", "1", "2", "3", "4", "5</br>Totally moral"];       //new
  var scaleSincere = ["0</br>Not sincere at all", "1", "2", "3", "4", "5</br>Totally sincere"]; //new

  // Adjustment
  var scaleWellAdjusted = ["0</br>Not well-adjusted at all", "1", "2", "3", "4", "5</br>Totally well-adjusted"];
  var scaleSatisfied  = ["0</br>Not satisfied at all", "1", "2", "3", "4", "5</br>Totally satisfied"];
  var scaleHappy  = ["0</br>Not happy at all", "1", "2", "3", "4", "5</br>Totally happy"];
  var scaleConfident  = ["0</br>Not confident at all", "1", "2", "3", "4", "5</br>Totally confident"];
  var scaleSelfRegard  = ["0</br>Unlikely to have a positive self-regard", "1", "2", "3", "4", "5</br>Likely to have a positive self-regard"];
  var scaleHealthy  = ["0</br>Not healthy at all", "1", "2", "3", "4", "5</br>Totally healthy"];

  // Potency
  var scaleStrong = ["0</br>Not strong at all", "1", "2", "3", "4", "5</br>Totally strong"];
  var scaleSelfAssertive = ["0</br>Not self-assertive at all", "1", "2", "3", "4", "5</br>Totally self-assertive"];
  var scaleDominant  = ["0</br>Not dominant at all", "1", "2", "3", "4", "5</br>Totally dominant"];
  var scaleLeader  = ["0</br>Unlikely to act as a leader", "1", "2", "3", "4", "5</br>Likely to act as a leader"];

  // Vanity, materialistic and sexually permissive orientation
  var scaleVain = ["0</br>Not vain at all", "1", "2", "3", "4", "5</br>Totally vain"];
  var scaleElitist = ["0</br>Not elitist at all", "1", "2", "3", "4", "5</br>Totally elitist"];
  var scaleSnobbish = ["0</br>Not snobbish at all", "1", "2", "3", "4", "5</br>Totally snobbish"];
  var scaleShallow = ["0</br>Not shallow at all", "1", "2", "3", "4", "5</br>Totally shallow"];
  var scaleHumble = ["0</br>Not humble", "1", "2", "3", "4", "5</br>Totally humble"];
  var scaleMaterialistic = ["0</br>Not materialistic at all", "1", "2", "3", "4", "5</br>Totally materialistic"];
  var scalePompous = ["0</br>Not pompous at all", "1", "2", "3", "4", "5</br>Totally pompous"];
  var scalePrudish = ["0</br>Not prudish at all", "1", "2", "3", "4", "5</br>Totally prudish"];
  var scaleBoastful = ["0</br>Not boastful at all", "1", "2", "3", "4", "5</br>Totally boastful"];

  // Physical threat
  var scaleViolent = ["0</br>Not violent at all", "1", "2", "3", "4", "5</br>Totally violent"];          // new
  var scaleAggressive = ["0</br>Not aggressive at all", "1", "2", "3", "4", "5</br>Totally aggressive"]; // new
  var scaleHateful = ["0</br>Not hateful at all", "1", "2", "3", "4", "5</br>Totally hateful"];          // new
  var scaleHurtful = ["0</br>Not hurtful at all", "1", "2", "3", "4", "5</br>Totally hurtful"];          // new

  // Physical attractiveness
  var scaleAttractive = ["0</br>Not attractive physically at all", "1", "2", "3", "4", "5</br>Totally attractive physically"]; // new
  var scaleCute = ["0</br>Not cute at all", "1", "2", "3", "4", "5</br>Totally cute"];                                         // new
  var scaleDisgusting = ["0</br>Not disgusting at all", "1", "2", "3", "4", "5</br>Totally disgusting"];                       // new
  var scaleBeautiful = ["0</br>Not beautiful at all", "1", "2", "3", "4", "5</br>Totally beautiful"];                          // new

// Condition-level CIs
  var judgments_condition = [];
  CIsStims_condition.map(function(ciImg){
    var likert_trial = {
        type: 'survey-likert',
        preamble: ciImg.imgHtml,
        questions: [
          {prompt: "", labels: scaleSociable, required: true},
          {prompt: "", labels: scaleFunLoving, required: true},
          {prompt: "", labels: scaleLikable, required: true},
          {prompt: "", labels: scalePopular, required: true},
          {prompt: "", labels: scaleIntelligent, required: true},
          {prompt: "", labels: scaleSkillful, required: true},
          {prompt: "", labels: scaleRational, required: true},
          {prompt: "", labels: scaleScientific, required: true},
          {prompt: "", labels: scaleAmbitious, required: true},
          {prompt: "", labels: scaleHardWorking, required: true},
          {prompt: "", labels: scaleSuccess, required: true},
          {prompt: "", labels: scaleSensitive, required: true},
          {prompt: "", labels: scaleEmpathic, required: true},
          {prompt: "", labels: scaleCompassionate, required: true},
          {prompt: "", labels: scaleGenerous, required: true},
          {prompt: "", labels: scaleModest, required: true},
          {prompt: "", labels: scaleEgoistic, required: true},
          {prompt: "", labels: scaleTrustworthy, required: true},
          {prompt: "", labels: scaleHonest, required: true},
          {prompt: "", labels: scaleFaithful, required: true},
          {prompt: "", labels: scaleWellAdjusted, required: true},
          {prompt: "", labels: scaleSatisfied, required: true},
          {prompt: "", labels: scaleHappy, required: true},
          {prompt: "", labels: scaleConfident, required: true},
          {prompt: "", labels: scaleSelfRegard, required: true},
          {prompt: "", labels: scaleHealthy, required: true},
          {prompt: "", labels: scaleStrong, required: true},
          {prompt: "", labels: scaleSelfAssertive, required: true},
          {prompt: "", labels: scaleDominant, required: true},
          {prompt: "", labels: scaleLeader, required: true},
          {prompt: "", labels: scaleVain, required: true},
          {prompt: "", labels: scaleElitist, required: true},
          {prompt: "", labels: scaleSnobbish, required: true},
          {prompt: "", labels: scaleShallow, required: true},
          {prompt: "", labels: scaleHumble, required: true},
          {prompt: "", labels: scaleMaterialistic, required: true},
          {prompt: "", labels: scalePompous, required: true},
          {prompt: "", labels: scalePrudish, required: true},
          {prompt: "", labels: scaleBoastful, required: true},
          {prompt: "", labels: scaleFriendly, required: true},      //new
          {prompt: "", labels: scaleFunny, required: true},         //new
          {prompt: "", labels: scaleAgreeable, required: true},     //new
          {prompt: "", labels: scaleWarm, required: true},          //new
          {prompt: "", labels: scaleSneaky, required: true},        //new
          {prompt: "", labels: scaleMoral, required: true},         //new
          {prompt: "", labels: scaleSincere, required: true},       //new
          {prompt: "", labels: scaleViolent, required: true},       //new
          {prompt: "", labels: scaleAggressive, required: true},    //new
          {prompt: "", labels: scaleHateful, required: true},       //new
          {prompt: "", labels: scaleHurtful, required: true},       //new
          {prompt: "", labels: scaleAttractive, required: true},    //new
          {prompt: "", labels: scaleCute, required: true},          //new
          {prompt: "", labels: scaleDisgusting, required: true},    //new
          {prompt: "", labels: scaleBeautiful, required: true},     //new
        ],
        button_label: 'Continue',
        on_load: function() {
          $(".jspsych-content").css("max-width", "100%");
          $(".jspsych-survey-likert-statement").css("margin", "0px");
          $(".jspsych-survey-likert-statement").css("padding", "0px");
          $(".jspsych-survey-likert-opts").css("padding", "0 0 10px");
          $("#jspsych-survey-likert-next").css("margin-top", "10px");
          $("#jspsych-survey-likert-form").css("width", "800px");
          $("li").css("width", "9%");
        //   $("li:first-of-type").css("width", "110px");
        //   $("li:last-of-type").css("width", "110px");
        },
        on_finish: function(data) {
          var parsed_response  = JSON.parse(data.responses);
          data.sociable      = parsed_response.Q0;
          data.funloving     = parsed_response.Q1;
          data.likable       = parsed_response.Q2;
          data.popular       = parsed_response.Q3;
          data.intelligent   = parsed_response.Q4;
          data.skillful      = parsed_response.Q5;
          data.rational      = parsed_response.Q6;
          data.scientific    = parsed_response.Q7;
          data.ambitious     = parsed_response.Q8;
          data.hardworking   = parsed_response.Q9;
          data.success       = parsed_response.Q10;
          data.sensitive     = parsed_response.Q11;
          data.empathic      = parsed_response.Q12;
          data.compassionate = parsed_response.Q13;
          data.generous      = parsed_response.Q14;
          data.modest        = parsed_response.Q15;
          data.egoistic      = parsed_response.Q16;
          data.trustworthy   = parsed_response.Q17;
          data.honest        = parsed_response.Q18;
          data.faithful      = parsed_response.Q19;
          data.welladjusted  = parsed_response.Q20;
          data.satisfied     = parsed_response.Q21;
          data.happy         = parsed_response.Q22;
          data.confident     = parsed_response.Q23;
          data.selfregard    = parsed_response.Q24;
          data.healthy       = parsed_response.Q25;
          data.strong        = parsed_response.Q26;
          data.selfassertive = parsed_response.Q27;
          data.dominant      = parsed_response.Q28;
          data.leader        = parsed_response.Q29;
          data.vain          = parsed_response.Q30;
          data.elitist       = parsed_response.Q31;
          data.snobbish      = parsed_response.Q32;
          data.shallow       = parsed_response.Q33;
          data.humble        = parsed_response.Q34;
          data.materialistic = parsed_response.Q35;
          data.pompous       = parsed_response.Q36;
          data.prudish       = parsed_response.Q37;
          data.boastful     = parsed_response.Q38;
          data.friendly      = parsed_response.Q39;
          data.funny         = parsed_response.Q40;
          data.agreeable     = parsed_response.Q41;
          data.warm          = parsed_response.Q42;
          data.sneaky        = parsed_response.Q43;
          data.moral         = parsed_response.Q44;
          data.sincere       = parsed_response.Q45;
          data.violent       = parsed_response.Q46;
          data.aggressive    = parsed_response.Q47;
          data.hateful       = parsed_response.Q48;
          data.hurtful       = parsed_response.Q49;
          data.attractive    = parsed_response.Q50;
          data.cute          = parsed_response.Q51;
          data.disgusting    = parsed_response.Q52;
          data.beautiful     = parsed_response.Q53;
          data.ci              = ciImg.imgHtml;
        },
    };
    judgments_condition.push(likert_trial);
  });

// Subgroup-level CIs
  var judgments_subgroup = [];
  CIsStims_subgroup.map(function(ciImg){
    var likert_trial = {
        type: 'survey-likert',
        preamble: ciImg.imgHtml,
        questions: [
          {prompt: "", labels: scaleSociable, required: true},
          {prompt: "", labels: scaleFunLoving, required: true},
          {prompt: "", labels: scaleLikable, required: true},
          {prompt: "", labels: scalePopular, required: true},
          {prompt: "", labels: scaleIntelligent, required: true},
          {prompt: "", labels: scaleSkillful, required: true},
          {prompt: "", labels: scaleRational, required: true},
          {prompt: "", labels: scaleScientific, required: true},
          {prompt: "", labels: scaleAmbitious, required: true},
          {prompt: "", labels: scaleHardWorking, required: true},
          {prompt: "", labels: scaleSuccess, required: true},
          {prompt: "", labels: scaleSensitive, required: true},
          {prompt: "", labels: scaleEmpathic, required: true},
          {prompt: "", labels: scaleCompassionate, required: true},
          {prompt: "", labels: scaleGenerous, required: true},
          {prompt: "", labels: scaleModest, required: true},
          {prompt: "", labels: scaleEgoistic, required: true},
          {prompt: "", labels: scaleTrustworthy, required: true},
          {prompt: "", labels: scaleHonest, required: true},
          {prompt: "", labels: scaleFaithful, required: true},
          {prompt: "", labels: scaleWellAdjusted, required: true},
          {prompt: "", labels: scaleSatisfied, required: true},
          {prompt: "", labels: scaleHappy, required: true},
          {prompt: "", labels: scaleConfident, required: true},
          {prompt: "", labels: scaleSelfRegard, required: true},
          {prompt: "", labels: scaleHealthy, required: true},
          {prompt: "", labels: scaleStrong, required: true},
          {prompt: "", labels: scaleSelfAssertive, required: true},
          {prompt: "", labels: scaleDominant, required: true},
          {prompt: "", labels: scaleLeader, required: true},
          {prompt: "", labels: scaleVain, required: true},
          {prompt: "", labels: scaleElitist, required: true},
          {prompt: "", labels: scaleSnobbish, required: true},
          {prompt: "", labels: scaleShallow, required: true},
          {prompt: "", labels: scaleHumble, required: true},
          {prompt: "", labels: scaleMaterialistic, required: true},
          {prompt: "", labels: scalePompous, required: true},
          {prompt: "", labels: scalePrudish, required: true},
          {prompt: "", labels: scaleBoastful, required: true},
          {prompt: "", labels: scaleFriendly, required: true},      //new
          {prompt: "", labels: scaleFunny, required: true},         //new
          {prompt: "", labels: scaleAgreeable, required: true},     //new
          {prompt: "", labels: scaleWarm, required: true},          //new
          {prompt: "", labels: scaleSneaky, required: true},        //new
          {prompt: "", labels: scaleMoral, required: true},         //new
          {prompt: "", labels: scaleSincere, required: true},       //new
          {prompt: "", labels: scaleViolent, required: true},       //new
          {prompt: "", labels: scaleAggressive, required: true},    //new
          {prompt: "", labels: scaleHateful, required: true},       //new
          {prompt: "", labels: scaleHurtful, required: true},       //new
          {prompt: "", labels: scaleAttractive, required: true},    //new
          {prompt: "", labels: scaleCute, required: true},          //new
          {prompt: "", labels: scaleDisgusting, required: true},    //new
          {prompt: "", labels: scaleBeautiful, required: true},     //new
        ],
        button_label: 'Continue',
        on_load: function() {
          $(".jspsych-content").css("max-width", "100%");
          $(".jspsych-survey-likert-statement").css("margin", "0px");
          $(".jspsych-survey-likert-statement").css("padding", "0px");
          $(".jspsych-survey-likert-opts").css("padding", "0 0 10px");
          $("#jspsych-survey-likert-next").css("margin-top", "10px");
          $("#jspsych-survey-likert-form").css("width", "800px");
          $("li").css("width", "9%");
        //   $("li:first-of-type").css("width", "110px");
        //   $("li:last-of-type").css("width", "110px");
        },
        on_finish: function(data) {
          var parsed_response  = JSON.parse(data.responses);
          data.sociable      = parsed_response.Q0;
          data.funloving     = parsed_response.Q1;
          data.likable       = parsed_response.Q2;
          data.popular       = parsed_response.Q3;
          data.intelligent   = parsed_response.Q4;
          data.skillful      = parsed_response.Q5;
          data.rational      = parsed_response.Q6;
          data.scientific    = parsed_response.Q7;
          data.ambitious     = parsed_response.Q8;
          data.hardworking   = parsed_response.Q9;
          data.success       = parsed_response.Q10;
          data.sensitive     = parsed_response.Q11;
          data.empathic      = parsed_response.Q12;
          data.compassionate = parsed_response.Q13;
          data.generous      = parsed_response.Q14;
          data.modest        = parsed_response.Q15;
          data.egoistic      = parsed_response.Q16;
          data.trustworthy   = parsed_response.Q17;
          data.honest        = parsed_response.Q18;
          data.faithful      = parsed_response.Q19;
          data.welladjusted  = parsed_response.Q20;
          data.satisfied     = parsed_response.Q21;
          data.happy         = parsed_response.Q22;
          data.confident     = parsed_response.Q23;
          data.selfregard    = parsed_response.Q24;
          data.healthy       = parsed_response.Q25;
          data.strong        = parsed_response.Q26;
          data.selfassertive = parsed_response.Q27;
          data.dominant      = parsed_response.Q28;
          data.leader        = parsed_response.Q29;
          data.vain          = parsed_response.Q30;
          data.elitist       = parsed_response.Q31;
          data.snobbish      = parsed_response.Q32;
          data.shallow       = parsed_response.Q33;
          data.humble        = parsed_response.Q34;
          data.materialistic = parsed_response.Q35;
          data.pompous       = parsed_response.Q36;
          data.prudish       = parsed_response.Q37;
          data.boastful     = parsed_response.Q38;
          data.friendly      = parsed_response.Q39;
          data.funny         = parsed_response.Q40;
          data.agreeable     = parsed_response.Q41;
          data.warm          = parsed_response.Q42;
          data.sneaky        = parsed_response.Q43;
          data.moral         = parsed_response.Q44;
          data.sincere       = parsed_response.Q45;
          data.violent       = parsed_response.Q46;
          data.aggressive    = parsed_response.Q47;
          data.hateful       = parsed_response.Q48;
          data.hurtful       = parsed_response.Q49;
          data.attractive    = parsed_response.Q50;
          data.cute          = parsed_response.Q51;
          data.disgusting    = parsed_response.Q52;
          data.beautiful     = parsed_response.Q53;
          data.ci              = ciImg.imgHtml;
        },
    };
    judgments_subgroup.push(likert_trial);
  });

  /* AGE */
  var age = {
      timeline: [{
        type: 'survey-text',
        questions: [{prompt: "How old are you?", rows: 1, columns: 10}],
        button_label: "Continue",
      }],
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      loop_function: function(data){ 
        var age = data.values()[0].responses;
        var age = JSON.parse(age).Q0; 
        if(age == ""){
          alert("Please indicate your age"); 
          return true; 
        }
      },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              age: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var gender = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Please indicate your gender:", options: ['Male', 'Female', 'Other'], required: true}],
      button_label: "Continue",
      on_finish: function(data) {
          jsPsych.data.addProperties({
              gender: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var languageOptions = ['Native speaker', 'Very well', 'Well', 'Average', 'Badly', 'Very badly'];
  var language = {
        type: 'survey-multi-choice',
        questions: [{ prompt: "How well do you speak english?", options: languageOptions, required: true }],
        button_label: "continue",
        on_finish: function (data) {
            jsPsych.data.addProperties({
                language: JSON.parse(data.responses).Q0,
            });
            console.log(data);
        },
    };

  var Prolific_reported = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'Please indicate your Prolific ID:', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_finish: function (data) {
            jsPsych.data.addProperties({
                Prolific_reported: JSON.parse(data.responses).Q0,
            });
        },
    };

  var comments = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'Do you have comments regarding this study? [Optional]', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        on_finish: function (data) {
            jsPsych.data.addProperties({
                Comment: JSON.parse(data.responses).Q0,
            });
        },
    };

  /* EXIT FULLSCREEN MODE */
  var exitFullscreen = {
    type: 'fullscreen',
    fullscreen_mode: false
  };

  /* DEBRIEF */
  var debrief = [];
  debrief += "<h1>End of the study</h1>";
  debrief += "<p class='justify'>Thank you for your participation! The aim of this study was to investigate the perception ";
  debrief += "of unknown and ambiguous faces that were generated in another experiment.</br></br> "
  debrief += "You can copy this code on Prolific: <b>1C606110</b> ";
  debrief += "or you can click on the following link to validate your participation:</p>";
  debrief += "<a href='https://app.prolific.co/submissions/complete?cc=1C606110' target='_blank'>click here</a>";

  // TIMELINE ----------------------------------------------------------------------------------------------------------
  timeline.push(consent);
  timeline.push(Quit_expe);
  timeline.push(activeFullscreen);
  timeline.push(instr_gene);
  timeline.push(previewCIinst_avg);
  timeline.push(previewCI_avg);
  timeline.push(jugmentInst_avg);
  timeline.push(judgments_condition);
  timeline.push(previewCIinst_subgroup);
  timeline.push(previewCI_subgroup);
  timeline.push(jugmentInst_subgroup);
  timeline.push(judgments_subgroup);
  timeline.push(age);
  timeline.push(gender);
  timeline.push(language);
  timeline.push(Prolific_reported);
  timeline.push(comments);  
  timeline.push(exitFullscreen);
  
  timeline = flatten(timeline); // do not remove this!

  // INITIALISE EXP ----------------------------------------------------------------------------------------------------
  jsPsych.init({
    timeline: timeline,
    preload_images: preloadimages,
    max_load_time: 500*1000,
    exclusions: {
      min_width: 700,
      min_height: 550,
    },
    on_finish: function(data) { 
      $("#jspsych-content").html("<img src='https://i.gifer.com/4V0b.gif'>");

      /* Initialize Firebase */
      var config = {
        apiKey: "AIzaSyBwDr8n-RNCbBOk1lKIxw7AFgslXGcnQzM",
        databaseURL: "https://postdocgent.firebaseio.com/"
      };

      firebase.initializeApp(config);
      var database = firebase.database();
      id = jsPsych.randomization.randomID(15); // short ID

      /* jsPsych: add data to every trial */
      jsPsych.data.addProperties({
        prolificID: prolificID,
        id: id,
        totalTime: jsPsych.totalTime()
      });

      var subdata = data.filter({trial_type: 'survey-likert'}).csv();
      //jsPsych.data.displayData();

      /* Send data to Firebase and redirect to Qualtrics */
      database.ref("Eval_Cis_PreExpe_Subgroup/" + id + "/").update({subdata}).then(function() { 
        console.log("data sent!");
        $("#jspsych-content").html(debrief);
        //window.location = qlink; // redirect to qualtrics
      });
    }
  });
</script>

</html>